#!/usr/bin/env python3
import onnx
import numpy as np
import onnxruntime
#from onnxruntime import InferenceSession

model_path = "/home/koyo/unitree_ros2/unitree_ws/src/unitree_rl/files/policy_12000.onnx"
model = onnx.load(model_path)
onnx.checker.check_model(model)
print(onnx.helper.printable_graph(model.graph))

sess = onnxruntime.InferenceSession(model.SerializeToString())
# sess = InferenceSession(model.SerializeToString())

input_name = sess.get_inputs()[0].name
print("Input name  :", input_name)
input_shape = sess.get_inputs()[0].shape
print("Input shape :", input_shape)
input_type = sess.get_inputs()[0].type
print("Input type  :", input_type)
# Input name  : obs
# Input shape : [1, 235]
# Input type  : tensor(float)

output_name = sess.get_outputs()[0].name
print("Output name  :", output_name)  
output_shape = sess.get_outputs()[0].shape
print("Output shape :", output_shape)
output_type = sess.get_outputs()[0].type
print("Output type  :", output_type)
# Output name  : actions
# Output shape : [1, 12]
# Output type  : tensor(float)

obs = np.random.random(input_shape) * 6 - 3
#print("obs type: ", type(obs)) #<class 'numpy.ndarray'>
obs = obs.astype(np.float32)
print("obs: ", obs) #below
#print("obs type: ", type(obs)) #<class 'numpy.ndarray'>
#print("obs shape: ", obs.shape) #(1, 235)
action = sess.run([output_name], {input_name: obs})
print("action: ", action) #below
#print("action type: ", type(action)) #<class 'list'>


# obs:  [[ 7.29087174e-01 -1.95291474e-01 -2.04793048e+00  8.63904431e-02
#   -2.64131117e+00 -1.38244367e+00  1.11032569e+00 -7.46107221e-01
#   -4.08858235e-04  2.93834877e+00 -3.51425439e-01 -2.90595818e+00
#    1.67419338e+00  4.91196483e-01  2.11650658e+00 -2.77949548e+00
#    5.50934136e-01  1.39621449e+00 -1.70002063e-03 -5.24082743e-02
#    1.94212186e+00  5.17015696e-01  2.89125609e+00  2.16758585e+00
#    2.12511897e+00  1.82514882e+00  6.04652107e-01  1.52801096e+00
#   -3.01817447e-01 -1.23832655e+00 -1.18205264e-01  2.10069060e-01
#   -2.45539355e+00 -2.08359748e-01 -1.48988605e+00 -1.81214854e-01
#   -8.47954333e-01 -4.78860676e-01 -1.41031528e+00  1.60362160e+00
#    4.72939134e-01 -1.52237678e+00  1.88242018e+00  1.15016723e+00
#   -4.64674950e-01 -2.93155336e+00  1.05777133e+00 -1.88801455e+00
#   -2.56518912e+00  2.46681643e+00 -1.09302366e+00 -1.92785132e+00
#    2.16580534e+00 -1.00451159e+00 -5.43772042e-01  1.03439498e+00
#   -6.40975475e-01 -6.92500532e-01  5.54455638e-01  2.86239833e-01
#   -2.30751768e-01  1.33793068e+00  8.80873725e-02  4.30447876e-01
#   -7.18890905e-01 -1.27236581e+00 -2.98802948e+00  2.43655062e+00
#    1.26896071e+00  1.29185474e+00  8.69156063e-01  3.95956755e-01
#   -6.66507840e-01  2.42138600e+00  1.31036758e-01 -1.17118895e+00
#    8.84629309e-01  2.18467188e+00 -7.81241655e-01 -2.96725869e-01
#    4.51059759e-01 -1.11140108e+00 -2.73643374e+00 -7.95263708e-01
#   -4.39354450e-01 -1.90724635e+00  2.02068448e+00  8.92360032e-01
#   -7.46658802e-01 -2.20352101e+00 -2.68603539e+00 -1.40940320e+00
#    2.20349216e+00  1.76098049e+00 -2.50777960e+00  3.09440464e-01
#    2.84171123e-02 -1.69892049e+00  2.51096582e+00  6.08658493e-01
#    1.35021937e+00  4.34525877e-01 -2.60370255e+00  2.41954470e+00
#   -2.83014989e+00 -1.73269081e+00  9.96767342e-01 -2.77009201e+00
#   -5.50832808e-01  2.57532805e-01 -9.05819476e-01  1.19333804e+00
#    1.33991838e+00 -2.10629439e+00  7.15096414e-01 -1.68503416e+00
#   -5.57347238e-01  2.49649268e-02 -5.62787175e-01 -3.94096255e-01
#   -1.10120153e+00 -1.04376411e+00  2.17862797e+00 -1.78664994e+00
#   -1.50135076e+00  2.11846542e+00  1.49673927e+00 -1.95739627e+00
#    1.35584974e+00 -1.18259358e+00 -1.08992386e+00  9.84631896e-01
#   -1.18662226e+00 -2.15993142e+00 -1.55196035e+00  5.53963408e-02
#    1.56397712e+00  3.84713978e-01  6.07092321e-01 -1.70105922e+00
#   -2.14699626e+00  8.66866231e-01 -2.74477172e+00 -2.21111965e+00
#    1.53694916e+00 -1.47654843e+00  2.94110155e+00 -7.41821468e-01
#    1.37181103e-01  9.80305314e-01 -8.60474467e-01  1.80221903e+00
#    5.35120726e-01 -2.72919750e+00  2.73468351e+00 -1.84131742e+00
#   -2.41628194e+00 -1.19284523e+00  1.46554315e+00 -1.10060000e+00
#    3.81538898e-01  2.14581162e-01 -1.31421340e+00  2.79604959e+00
#    2.07584009e-01  1.16211438e+00  2.26502562e+00 -2.69296384e+00
#    2.16135129e-01  1.73525357e+00  4.23579395e-01  1.75642645e+00
#   -1.41533351e+00  7.63548076e-01  1.43746185e+00  6.66966915e-01
#   -5.53491414e-01  2.61275101e+00 -2.32952580e-01 -1.12778640e+00
#    2.61827850e+00 -1.02992821e+00 -2.29363990e+00  1.09601879e+00
#   -1.55490160e+00 -2.26904559e+00  1.58581281e+00 -2.11220241e+00
#   -2.39421964e+00 -2.17700958e+00  1.21267033e+00 -2.27317405e+00
#    2.64619660e+00 -2.45766354e+00 -1.66838610e+00 -1.64647174e+00
#   -1.70231736e+00  2.92748952e+00 -1.08179279e-01  9.92124259e-01
#   -2.59134126e+00  1.46777749e+00 -1.79751730e+00 -8.28095853e-01
#   -1.83142269e+00  1.57103240e+00  1.10477841e+00  8.52384686e-01
#    8.15115631e-01 -2.74619412e+00 -1.40384793e-01 -4.43559021e-01
#   -2.62685537e+00  2.48390603e+00 -2.98928350e-01  2.23757315e+00
#    4.66874301e-01 -1.33483696e+00 -1.42912745e+00 -1.88809502e+00
#    1.37938869e+00  1.36935115e+00 -8.20300043e-01 -2.06519556e+00
#   -2.92669964e+00  1.80923700e+00  2.77218914e+00 -2.16868448e+00
#    1.68272519e+00  2.18957615e+00  2.96240878e+00 -2.04727411e+00
#   -2.09118724e+00  2.98962688e+00 -8.55481565e-01]]
# action:  [array([[  1.3503804 ,  -0.69755137,  -2.8006139 ,   4.181825  ,
#          -1.9209244 , -14.837686  ,   0.8290266 ,  -4.094282  ,
#           0.28250822,  14.298942  ,   8.760874  ,  -6.7025366 ]],
#       dtype=float32)]


